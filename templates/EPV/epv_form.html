{% extends '../base.html' %}
{% block content %}
<div class="container mt-4" style="width: 80%; margin-left: 17%;">
    <h2>{% if form.instance.pk %}Modifier EPV{% else %}Créer un nouvel EPV{% endif %}</h2>
    <form method="POST" enctype="multipart/form-data" class="mt-3">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-success" style="margin-left: 20%; width: 20%;height: 40%;">Enregistrer</button>
        <a href="{% url 'epv_list' %}" class="btn btn-default" style="width: 20%;">Annuler</a>
    </form>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const regionSelect = document.querySelector('select[name="region"]');
        const departementSelect = document.querySelector('select[name="departement"]');
        const communeSelect = document.querySelector('select[name="commune"]');
        const maladieField = document.querySelector('select[name="maladie"]');
        const effectifMarqueGroup = document.getElementById('effectif-marque-group');
    
    
        function updateDepartements() {
            const regionId = regionSelect.value;
            if (regionId) {
                fetch(`/epv_create/get_departements/?region_id=${regionId}`)
                    .then(response => response.json())
                    .then(data => {
                        departementSelect.innerHTML = '<option value="">Sélectionner un département</option>';
                        data.forEach(departement => {
                            departementSelect.innerHTML += `<option value="${departement.id}">${departement.Nom}</option>`;
                        });
                        communeSelect.innerHTML = '<option value="">Sélectionner une commune</option>'; // Réinitialiser les communes
                    });
            } else {
                departementSelect.innerHTML = '<option value="">Sélectionner un département</option>';
                communeSelect.innerHTML = '<option value="">Sélectionner une commune</option>'; // Réinitialiser les communes
            }
        }
    
        function updateCommunes() {
            const departementId = departementSelect.value;
            if (departementId) {
                fetch(`/epv_create/get_communes/?departement_id=${departementId}`)
                    .then(response => response.json())
                    .then(data => {
                        communeSelect.innerHTML = '<option value="">Sélectionner une commune</option>';
                        data.forEach(commune => {
                            communeSelect.innerHTML += `<option value="${commune.id}">${commune.Nom}</option>`;
                        });
                    });
            } else {
                communeSelect.innerHTML = '<option value="">Sélectionner une commune</option>'; // Réinitialiser les communes
            }
        }
    
        regionSelect.addEventListener('change', updateDepartements);
        departementSelect.addEventListener('change', updateCommunes);
       
        // Initialiser la visibilité et les options en fonction des sélections actuelles
        if (regionSelect.value) updateDepartements();
        if (departementSelect.value) updateCommunes();
    });
    
    </script>
   
{% endblock %}
