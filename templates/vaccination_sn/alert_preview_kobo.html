{% extends "base.html" %}
{% block content %}
<div class="content-wrapper">
  <section class="content-header"><h1>Alerte CAMVAC (Kobo) – Prévisualisation</h1></section>
  <section class="content">
    <form method="post" class="box box-primary">
      {% csrf_token %}
      <input type="hidden" name="send" value="1">
      <div class="box-body">
        <div class="row">
          <div class="col-sm-4">
            <label>Campagne</label>
            <input name="campagne" value="{{ campagne }}" class="form-control" placeholder="ex: CAMVAC 2025">
          </div>
          <div class="col-sm-4">
            <label>Type de campagne</label>
            <input name="type_campagne" value="{{ type_campagne }}" class="form-control" placeholder="Masse / Ciblée">
          </div>
          <div class="col-sm-4">
            <label>Semaine ISO</label>
            <input name="semaine_iso" value="{{ semaine_iso }}" class="form-control" placeholder="2025-W22">
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col-sm-4">
            <label>Seuil réalisation (%)</label>
            <input name="th_real" type="number" step="0.01" value="{{ thresholds.real }}" class="form-control">
          </div>
          <div class="col-sm-4">
            <label>Seuil couverture (%)</label>
            <input name="th_couv" type="number" step="0.01" value="{{ thresholds.couv }}" class="form-control">
          </div>
          <div class="col-sm-4">
            <label>Seuil approvisionnement (%)</label>
            <input name="th_app"  type="number" step="0.01" value="{{ thresholds.app }}" class="form-control">
          </div>
        </div>

        <div class="form-group" style="margin-top:10px">
          <label>Destinataires supplémentaires (CSV)</label>
          <input name="extra_emails" value="{{ extra_emails }}" class="form-control"
                 placeholder="dsv@example.org, dsa@example.org">
          <p class="help-block">Les destinataires principaux viennent de <code>alerts.DestinataireAlerte</code> (actifs &ldquo;Vaccination&rdquo;).</p>
        </div>
      </div>
      <div class="box-footer">
        <button class="btn btn-primary"><i class="fa fa-send"></i> Envoyer maintenant</button>
      </div>
    </form>

    {% if preview %}
    <div class="box">
      <div class="box-header with-border"><h3 class="box-title">{{ preview.subject }}</h3></div>
      <div class="box-body">
        <p><strong>Destinataires :</strong> {{ preview.to|join:", " }}</p>
        <div style="border:1px solid #ddd; background:#fff; padding:10px;">
          {{ preview.html|safe }}
        </div>
      </div>
    </div>
    {% endif %}
  </section>
</div>
{% endblock %}
