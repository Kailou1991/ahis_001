{% extends 'base.html' %}
{% block content %}
<div class="container mt-4" style="text-align: center;">
  <h2>Situation contr√¥le documentaire des importations ‚Äì (PIF)</h2>

  <!-- Formulaire de filtre par date -->
  <form method="get" class="row g-2 mb-4" id="filtre-form">
    <div class="col-md-3">
      <label for="date_debut">Date d√©but</label>
      <input type="date" class="form-control" name="date_debut" value="{{ date_debut }}">
    </div>
    <div class="col-md-3">
      <label for="date_fin">Date fin</label>
      <input type="date" class="form-control" name="date_fin" value="{{ date_fin }}">
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button type="submit" class="btn btn-outline-primary">Filtrer</button>
    </div>
  </form>
 <div id="print-section">
  {% if date_debut and date_fin %}
    <div class="alert alert-info">
      Affichage des factures entre le {{ date_debut }} et le {{ date_fin }}
    </div>
  {% endif %}

 
    <h4 class="mt-4 text-success">‚úÖ Factures d√©j√† vis√©es</h4>
    <table class="table table-bordered table-striped" >
      <thead>
        <tr>
          <th>Structure importatrice</th>
          <th>Num√©ro</th>
          <th>Date visa PIF</th>
          <th>Contr√¥l√© par</th>
        </tr>
      </thead>
      <tbody>
        {% for f in visees %}
          <tr>
            <td>{{ f.Structure }}</td>
            <td>{{ f.numero_facture }}</td>
            <td>{{ f.date_visa_pif|date:"d/m/Y H:i" }}</td>
            <td>{{ f.vise_par_pif }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="4">Aucune facture vis√©e.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <h4 class="mt-5 text-warning">üìã Factures vis√©es par la DSV mais non encore contr√¥l√©es par les PIF</h4>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Structure importatrice</th>
          <th>Num√©ro</th>
          <th>Date visa DSV</th>
          <th>Vis√©e √† la DSV par</th>
        </tr>
      </thead>
      <tbody>
        {% for f in non_visees %}
          <tr>
            <td>{{ f.Structure }}</td>
            <td>{{ f.numero_facture }}</td>
            <td>{{ f.date_visa_dsv|date:"d/m/Y" }}</td>
            <td>{{ f.vise_par_dsv }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="4">Aucune facture en attente de visa PIF.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="text-end mt-3">
    <button class="btn btn-outline-secondary" onclick="printSection('print-section')">
      üñ®Ô∏è Imprimer ces tableaux
    </button>
  </div>
</div>

<script>
  function printSection(id) {
    const content = document.getElementById(id).innerHTML;
    const original = document.body.innerHTML;
    document.body.innerHTML = content;
    window.print();
    document.body.innerHTML = original;
    location.reload();
  }
</script>
{% endblock %}
